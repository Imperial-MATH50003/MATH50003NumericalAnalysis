**Numerical Analysis MATH50003 (2024â€“25) Problem Sheet 3**


**Problem 1** What is $Ï€$ to 5 binary places? Hint: recall that $Ï€ â‰ˆ 3.14$.

**SOLUTION**
We subtract off powers of two until we get 5 places. Eg we have
$$
Ï€ = 3.14â€¦ = 2 + 1.14â€¦ = 2 + 1 + 0.14â€¦ = 2 + 1 + 1/8 + 0.016â€¦ = 2 + 1 + 1/8  + 1/64  + 0.000â€¦
$$
Thus we have $Ï€ = (11.001001â€¦)_2$. The question is slightly ambiguous whether we want to round
to 5 digits so either `11.00100` or `11.00101` would be acceptable.
**END**

**Problem 2** What are the single precision $F_{32} = F_{127,8,23}$ floating point representations for the following: 
$$
2, \quad 31, \quad 32, \quad 23/4, \quad (23/4)\times 2^{100}
$$

**SOLUTION**
Recall that we have `Ïƒ,Q,S = 127,8,23`. Thus we write
$$
2 = 2^{128-127} * (1.00000000000000000000000)_2
$$
The exponent bits are those of
$$
128 = 2^7 = (10000000)_2
$$
Hence we get the bits 
```
0 10000000 00000000000000000000000
```
We write
$$
31 = (11111)_2 = 2^{131-127} * (1.1111)_2
$$
And note that $131 = (10000011)_2$ Hence we have the bits
```
0 10000011 11110000000000000000000
```

On the other hand,
$$
32 = (100000)_2 = 2^{132-127}
$$
and $132 = (10000100)_2$ hence we have the bits 
```
0 10000100 00000000000000000000000
```
Note that
$$
23/4 = 2^{-2} * (10111)_2 = 2^{129-127} * (1.0111)_2
$$
and $129 = (10000001)_2$ hence we get:
```
0 10000001 01110000000000000000000
```
Finally,
$$
23/4 * 2^{100} = 2^{229-127} * (1.0111)_2
$$
and $229 = (11100101)_2$ giving us:
```
0 11100101 01110000000000000000000
```
**END**


**Problem 3** Let $m(y) = \min\{x \in F_{32} : x > y \}$ be the smallest single precision number
greater than $y$. What is $m(2) - 2$ and $m(1024) - 1024$? 

**SOLUTION**
The next float after $2$ is $2 * (1 + 2^{-23})$ hence we get $m(2) - 2 = 2^{-22}$:
```julia
nextfloat(2f0) - 2, 2^(-22)
```
similarly, for $1024 = 2^{10}$ we find that the difference $m(1024) - 1024$ is $2^{10-23} = 2^{-13}$:
```julia
 nextfloat(1024f0) - 1024, 2^(-13)
```
**END**


**Problem 4** Suppose $x = 1.25$ and consider 16-bit floating point arithmetic ($F_{16}$).
What is the error in approximating $x$ by the nearest float point number ${\rm fl}(x)$?
What is the error in approximating $2x$, $x/2$, $x + 2$ and $x - 2$ by $2 \otimes x$, $x \oslash 2$, $x âŠ• 2$ and $x \ominus 2$?

**SOLUTION**
None of these computations have errors since they are all exactly representable as floating point numbers.
**END**



**Problem 5** Show that $1/5 = 2^{-3} (1.1001100110011â€¦)_2$.
What are the exact bits for $1 âŠ˜ 5$, $1 âŠ˜ 5 âŠ• 1$ computed
using  half-precision arithmetic ($F_{16} := F_{15,5,10}$) (using default rounding)?

**SOLUTION**

For the first part we use Geometric series:
$$
\meeq{
 2^{-3} (1.1001100110\magenta{011â€¦})_2 =  2^{-3} \left(âˆ‘_{k=0}^âˆž {1 \over 2^{4k}} +
{1 \over 2} âˆ‘_{k=0}^âˆž {1 \over 2^{4k}}\right) \ccr
= {3 \over 2^4} {1 \over 1-1/2^4} = {3 \over 2^4-1} = {1 \over 5}
}
$$
Write $-3 = 12 - 15$
hence we have $q = 12 = (01100)_2$.
Since $1/5$ is below the midpoint (the midpoint would have been the first magenta bit was 1 and all other bits are 0) we round down and hence have the bits:
$$
\red{0}\ \green{01100}\ \blue{1001100110}
$$
Adding $1$ we get:
$$
1 + 2^{-3} * (1.1001100110)_2 = (1.0011001100\magenta{11})_2 â‰ˆ (1.0011001101)_2
$$
Here we write the exponent as $0 = 15 - 15$ where $q = 15 = (01111)_2$.
Thus we have the bits:
$$
\red{0}\ \green{01111}\ \blue{0011001101}
$$

**END**

----

**Problem 6** Prove the following bounds on the _absolute error_ of a floating point calculation
in idealised floating-point arithmetic $F_{âˆž,S}$ (i.e., you may assume all operations involve normal floating point numbers):
$$
\begin{align*}
({\rm fl}(1.1) âŠ— {\rm fl}(1.2)) &âŠ• {\rm fl}(1.3) = 2.62 + Îµ_1 \\
({\rm fl}(1.1) âŠ– 1) & âŠ˜ {\rm fl}(0.1) = 1 + Îµ_2
\end{align*}
$$
such that $|Îµ_1| â‰¤ 11 Ïµ_{\rm m}$ and $|Îµ_2| â‰¤ 40 Ïµ_{\rm m}$, where $Ïµ_{\rm m}$ is
machine epsilon.


**SOLUTION**

The first problem is very similar to what we saw in lecture. Write
$$
({\rm fl}(1.1)âŠ— {\rm fl}(1.2)) âŠ• {\rm fl}(1.3) = ( 1.1(1 + Î´_1)1.2(1+Î´_2)(1+Î´_3) + 1.3(1+Î´_4))(1+Î´_5)
$$
where we have $|Î´_1|,â€¦,|Î´_5| â‰¤ Ïµ_{\rm m}/2$. We first write
$$
1.1(1 + Î´_1)1.2(1+Î´_2)(1+Î´_3) = 1.32( 1+ Îµ_1)
$$
where, using the bounds:
$$
|Î´_1Î´_2|,|Î´_1Î´_3|,|Î´_2Î´_3| â‰¤ Ïµ_{\rm m}/4, |Î´_1Î´_2Î´_3| â‰¤ Ïµ_{\rm m}/8
$$
we find that
$$
|Îµ_1| â‰¤ |Î´_1| + |Î´_2| + |Î´_3| + |Î´_1Î´_2| + |Î´_1Î´_3| + |Î´_2Î´_3|+ |Î´_1Î´_2Î´_3|
     â‰¤ (3/2 + 3/4 + 1/8) â‰¤ 5/2 Ïµ_{\rm m}
$$
Then we have
$$
1.32 (1 + Îµ_1) + 1.3 (1 + Î´_4) = 2.62 + \underbrace{1.32 Îµ_1 + 1.3Î´_4}_{Îµ_2}
$$
where
$$
|Îµ_2| â‰¤ (15/4 + 3/4) Ïµ_{\rm m} â‰¤ 5Ïµ_{\rm m}.
$$
Finally,
$$
(2.62 + Îµ_2)(1+Î´_5) = 2.62 + \underbrace{Îµ_2 + 2.62Î´_5 + Îµ_2 Î´_5}_{Îµ_3}
$$
where, using $|Îµ_2 Î´_5| â‰¤ 3Ïµ_{\rm m}$ we get,
$$
|Îµ_3| â‰¤ (5 + 3/2 + 3) Ïµ_{\rm m}  â‰¤ 10Ïµ_{\rm m}.
$$

For the second part, we do:
$$
({\rm fl}(1.1) âŠ– 1) âŠ˜ {\rm fl}(0.1) = {(1.1 (1 + Î´_1) - 1)(1 + Î´_2) \over 0.1 (1 + Î´_3)} (1 + Î´_4)
$$
where we have $|Î´_1|,â€¦,|Î´_4| â‰¤ Ïµ_{\rm m}/2$.
Write
$$
{1 \over 1 + Î´_3} = 1 + Îµ_1
$$
where, using that $|Î´_3| â‰¤ Ïµ_{\rm m}/2 â‰¤ 1/2$, we have
$$
|Îµ_1| â‰¤ \left| {Î´_3 \over 1 + Î´_3} \right| â‰¤  {Ïµ_{\rm m} \over 2} {1 \over 1 - 1/2} â‰¤ Ïµ_{\rm m}.
$$
Further write
$$
(1 + Îµ_1)(1 + Î´_4) = 1 + Îµ_2
$$
where
$$
|Îµ_2| â‰¤ |Îµ_1| + |Î´_4| + |Îµ_1| |Î´_4| â‰¤ (1 + 1/2 + 1/2) Ïµ_{\rm m} =   2Ïµ_{\rm m}.
$$
We also write
$$
{(1.1 (1 + Î´_1) - 1)(1 + Î´_2) \over 0.1} = 1 + \underbrace{11Î´_1 + Î´_2 + 11Î´_1Î´_2}_{Îµ_3}
$$
where
$$
|Îµ_3| â‰¤ (11/2 + 1/2  + 11/4) â‰¤ 9 Ïµ_{\rm m}
$$
Then we get
$$
({\rm fl}(1.1) âŠ– 1) âŠ˜ {\rm fl}(0.1) = (1 + Îµ_3) (1 + Îµ_2) =  1 + \underbrace{Îµ_3 + Îµ_2 + Îµ_2 Îµ_3}_{Îµ_4}
$$
and the error is bounded by:
$$
|Îµ_4| â‰¤ (9 + 2 + 18) Ïµ_{\rm m} â‰¤ 29 Ïµ_{\rm m}.
$$

**END**







**Problem 7**
Assume that $f^{\rm FP} : F_{âˆž,S} â†’ F_{âˆž,S}$ satisfies $f^{\rm FP}(x) = f(x) + Î´_x$ where $|Î´_x| â‰¤ c Ïµ_{\rm m}$ for all $x âˆˆ F_{âˆž,S}$.
Show that
$$
{f^{\rm FP}(x+h) âŠ– f^{\rm FP}(x-h) \over  2h} = f'(x) + Îµ
$$
where the (absolute) error is bounded by
$$
|Îµ| â‰¤ {|f'(x)| \over 2} Ïµ_{\rm m} + {M \over 3} h^2 + {2 c Ïµ_{\rm m} \over h}.
$$

**SOLUTION**

In floating point we have
$$
\begin{align*}
{f^{\rm FP}(x + h) âŠ– f^{\rm FP}(x-h) \over 2h} &= {f(x + h) +  Î´_{x+h} - f(x-h) - Î´_{x-h} \over 2h} (1 + Î´_1) \\
&= {f(x+h) - f(x-h) \over 2h} (1 + Î´_1) + {Î´_{x+h}- Î´_{x-h} \over 2h} (1 + Î´_1)
\end{align*}
$$
From PS1 Q4 we get the error term
$$
f'(x) = {f(x + h) - f(x-h) \over 2h} + Î´^{\rm T}
$$
where
$$
|Î´^{\rm T}| â‰¤ Mh^2/6.
$$
Thus
$$
(f^{\rm FP}(x + h) âŠ– f^{\rm FP}(x-h)) / (2h) =
f'(x) + \underbrace{f'(x) Î´_1 - Î´^{\rm T} (1 + Î´_1) + {Î´_{x+h}- Î´_{x-h} \over 2h} (1 + Î´_1)}_{Îµ}
$$
where
$$
|Îµ| â‰¤ {|f'(x)| \over 2} Ïµ_{\rm m} + {M \over 3} h^2 + {2 c Ïµ_{\rm m} \over h}.
$$


**END**

-----
**Problem 8(a)** Suppose $|Ïµ_k| â‰¤ Ïµ$ and $n Ïµ < 1$. Show that $âˆ_{k=1}^n (1+Ïµ_k) = 1+Î¸_n$
for some constant $Î¸_n$ satisfying
$$
|Î¸_n| â‰¤ \underbrace{n Ïµ \over 1-nÏµ}_{E_{n,Ïµ}}.
$$

**SOLUTION**

$$
âˆ_{k=1}^{n+1} (1+Ïµ_k) = âˆ_{k=1}^n (1+Ïµ_k) (1+Ïµ_{n+1}) = (1+Î¸_n)(1+Ïµ_{n+1}) = 1 + \underbrace{Î¸_n + Ïµ_{n+1} + Î¸_nÏµ_{n+1}}_{Î¸_{n+1}}
$$
where
$$
\begin{align*}
|Î¸_{n+1}| &â‰¤ {n Ïµ \over 1-nÏµ}(1+Ïµ) + Ïµ \\
&={n Ïµ + n Ïµ^2 \over 1-(n+1)Ïµ} \underbrace{{1-(n+1)Ïµ \over 1-nÏµ}}_{â‰¤ 1}  + {Ïµ-(n+1)Ïµ^2 \over 1-(n+1)Ïµ} \\
&â‰¤ {(n+1)  -  Ïµ \over 1-(n+1)Ïµ} Ïµ â‰¤ {(n+1) Ïµ \over 1-(n+1)Ïµ} = E_{n+1,Ïµ}.
\end{align*}
$$

**END**

**Problem 8(b)** Show if $x_1,â€¦,x_n âˆˆ F_{âˆž,S}$ then
$$
x_1 âŠ— â‹¯ âŠ— x_n = x_1 â‹¯ x_n (1 + Î¸_{n-1})
$$
where $|Î¸_n| â‰¤ E_{n,Ïµ_{\rm m}/2}$, assuming $n Ïµ_{\rm m} < 2$.

**SOLUTION**

We can expand out:
$$
x_1 âŠ— â‹¯ âŠ— x_n = (â‹¯((x_1 x_2)(1+Î´_1) x_3(1+Î´_2)â‹¯ x_n(1+Î´_{n-1})) = x_1 â‹¯ x_n (1+Î´_1) â‹¯ (1+Î´_{n-1})
$$
where $|Î´_k| â‰¤ Ïµ_{\rm m}/2$. The result then follows from the previous result.

**END**


**Problem 8(c)** Show if $x_1,â€¦,x_n âˆˆ F_{âˆž,S}$ then
$$
x_1 âŠ• â‹¯ âŠ• x_n = x_1 +  â‹¯ + x_n + Ïƒ_n
$$
where, for $M = Î£_{k=1}^n |x_k|$, $|Ïƒ_n| â‰¤ M E_{n-1,Ïµ_{\rm m}/2},$ assuming $n Ïµ_{\rm m} < 2$.


**SOLUTION**

Using Problem 8(a) we write:
$$
\meeq{
(â‹¯((x_1 + x_2)(1+Î´_1) + x_3)(1+Î´_2)â‹¯+x_n)(1+Î´_{n-1})
= x_1 âˆ_{k=1}^{n-1} (1+Î´_k) +  âˆ‘_{j=2}^n x_j âˆ_{k=j-1}^{n-1} (1+Î´_j) \ccr
= x_1(1+Î¸_{n-1}) + âˆ‘_{j=2}^n x_j (1 + Î¸_{n-j+1})
}
$$
where we have for $j = 2,â€¦,n$
$$
|Î¸_{n-j+1}| â‰¤ E_{n-j+1,Ïµ_{\rm m}/2} â‰¤ E_{n-1,Ïµ_{\rm m}/2}.
$$
Thus we have 
$$
âˆ‘_{j=1}^n x_j (1 + Î¸_{n-j+1})= âˆ‘_{j=1}^n x_j + \underbrace{âˆ‘_{j=1}^n x_j Î¸_{n-j+1}}_{Ïƒ_n}
$$
where
$$
|Ïƒ_n| â‰¤  âˆ‘_{j=1}^n |x_j Î¸_{n-j+1}| â‰¤ \sup_j |Î¸_{n-j+1}| âˆ‘_{j=1}^n |x_j|  â‰¤ \| ð±\|_1 E_{n-1,Ïµ_{\rm m}/2}.
$$


**END**